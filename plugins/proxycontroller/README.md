# 插件代理控制器

MoviePilot 第三方插件，用于控制其他插件是否使用 PROXY_HOST 代理。

## 功能特点

- 控制其他插件是否使用 PROXY_HOST 代理
- 为指定插件提供代理功能
- 支持按插件单独设置代理状态
- 支持一键开关所有插件代理
- 通过猴子补丁技术实现，对原插件代码无侵入
- 显示插件检测方法，方便排查问题

## 安装方法

1. 在 MoviePilot 插件商店中添加第三方仓库：`https://github.com/EWEDLCM/MoviePilot-Plugins`
2. 在第三方插件列表中找到并安装"插件代理控制器"
3. 进入插件设置页面完成配置

## 配置说明

- **启用插件代理控制**：开启或关闭插件代理控制功能
- **为所有插件启用代理**：为所有插件启用 PROXY_HOST 代理
- **选择需要代理的用户插件**：选择需要使用代理的用户安装的插件
- **选择需要代理的系统插件**：选择需要使用代理的系统内置插件

## 使用说明

1. 确保你的 MoviePilot 容器已经设置了正确的 PROXY_HOST 环境变量
2. 在插件配置中选择需要使用代理的插件：
   - 可以选择"为所有插件启用代理"，这样所有插件都会使用 PROXY_HOST 代理
   - 也可以选择特定的插件使用代理
3. 保存配置后，插件会自动为选中的插件添加代理功能
4. 在插件页面可以查看各个插件的代理状态和检测方法
5. 使用搜索框可以快速筛选插件列表

## 工作原理

本插件通过猴子补丁（Monkey Patching）技术修改了 Python requests 库的网络请求函数，在请求发出前根据调用插件的身份判断是否需要添加代理。这种方式不需要修改其他插件的代码，可以无侵入地为其他插件添加代理功能。

### 调用检测机制

插件使用多种方法检测发起网络请求的插件：

1. **调用栈分析**：分析 Python 调用栈，找到发起请求的插件实例
2. **堆栈跟踪**：通过文件路径分析，识别请求来源
3. **模块关联**：根据模块名称确定插件身份

### 插件目录检测机制

插件使用三种方法来检测插件目录：

1. **文件路径法**：通过当前文件路径推断
2. **系统路径法**：通过 Python 系统路径查找
3. **固定路径法**：尝试常见的插件目录路径

## 注意事项

- 此插件需要在其他插件之前加载，因此设置了较高的优先级
- 只能控制使用 Python requests 库发送网络请求的插件
- 插件只会为没有指定代理的请求添加 PROXY_HOST 代理
- 如果插件自身已经设置了代理，则不会被覆盖
- 建议在 MoviePilot 容器启动时已经配置好 PROXY_HOST 环境变量

## 更新日志

啥也没有